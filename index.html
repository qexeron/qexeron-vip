    <script src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const LAZY_DELAY = 2200; 
        
        // 1. URL dan parani o'qish
        const urlParams = new URLSearchParams(window.location.search);
        let rawSymbol = urlParams.get('symbol'); 
        
        // DEFAULT SYMBOL LOGIKASI
        let currentSymbol = "BINANCE:BTCUSDT"; // Agar hech narsa bo'lmasa

        if (rawSymbol) {
            // Agar URLda ikki nuqta (:) bo'lsa (Masalan: OANDA:XAUUSD), o'zini olamiz
            if (rawSymbol.includes(':')) {
                currentSymbol = rawSymbol;
            } 
            // Agar GOLD yoki XAUUSD bo'lsa -> OANDA birjasiga ulaymiz (Chart uchun)
            else if (rawSymbol === 'XAUUSD' || rawSymbol === 'GOLD') {
                currentSymbol = "OANDA:XAUUSD";
            }
            // Qolganlari (ETH, SOL) -> BINANCE ga ulaymiz
            else {
                currentSymbol = "BINANCE:" + rawSymbol;
            }
        }

        // 2. GRAFIKNI YUKLASH
        window.addEventListener('load', () => {
            setTimeout(() => {
                new TradingView.widget({
                    "autosize": true,
                    "symbol": currentSymbol,
                    "interval": "15",
                    "timezone": "Asia/Tashkent",
                    "theme": "dark",
                    "style": "1",
                    "locale": "en",
                    "toolbar_bg": "#080a0f",
                    "enable_publishing": false,
                    "allow_symbol_change": true,
                    "container_id": "q-terminal",
                    "hide_side_toolbar": false,
                    "details": false, "hotlist": false, "calendar": false  
                });
                document.getElementById('loading-gate').classList.add('hide');
            }, LAZY_DELAY);
        });

        // ðŸ” QIDIRUV FUNKSIYALARI
        function openSearch() {
            document.getElementById('search-modal').classList.add('open');
            document.getElementById('symbol-input').focus();
        }
        function closeSearch(e) {
            if (e.target.id === 'search-modal') document.getElementById('search-modal').classList.remove('open');
        }
        
        // Tezkor tugmalar (Chips)
        function quickSearch(sym) {
            window.location.href = `?symbol=${sym}`;
        }

        // Input orqali qidirish
        document.getElementById('symbol-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                let val = this.value.toUpperCase().trim();
                if(val) {
                    // GOLD yozsa -> XAUUSD ga o'zgartiramiz
                    if (val === 'GOLD') val = 'XAUUSD';

                    // Agar XAUUSD bo'lsa, unga USDT qo'shmaymiz!
                    // Agar kripto bo'lsa va oxirida USDT/USD bo'lmasa, qo'shib qo'yamiz
                    if (val !== 'XAUUSD' && !val.includes('USD') && !val.includes('EUR') && !val.includes('JPY')) {
                        val += 'USDT';
                    }
                    
                    window.location.href = `?symbol=${val}`;
                }
            }
        });

        // ðŸ¤– AI FUNKSIYASI (FIX QILINGAN JOYI ðŸ› )
        function openAI() {
            document.getElementById('ai-modal').classList.add('open');
            document.getElementById('technical-analysis-container').innerHTML = "";
            
            // AI uchun maxsus simvol tayyorlaymiz
            let aiSymbol = currentSymbol;

            // AGAR GOLD BO'LSA -> ANIQ "OANDA:XAUUSD" QILIB BERAMIZ
            // Chunki AI vidjeti "BINANCE:XAUUSD" ni tushunmaydi
            if (aiSymbol.includes('XAUUSD') || aiSymbol === 'GOLD') {
                aiSymbol = "OANDA:XAUUSD";
            }
            
            console.log("AI Analyzing: " + aiSymbol);

            const script = document.createElement("script");
            script.src = "https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js";
            script.async = true;
            script.innerHTML = JSON.stringify({
                "interval": "15m",
                "width": "100%",
                "isTransparent": true, 
                "height": "100%",
                "symbol": aiSymbol, // <--- O'zgartirilgan simvol ketdi
                "showIntervalTabs": true,
                "displayMode": "single",
                "locale": "en",
                "colorTheme": "dark"
            });
            document.getElementById('technical-analysis-container').appendChild(script);
        }

        function closeAI(e) {
            if (e.target.id === 'ai-modal' || e.target.classList.contains('close-ai')) {
                document.getElementById('ai-modal').classList.remove('open');
            }
        }

        function shareDynamicChart() {
            let symbol = currentSymbol.split(':').pop();
            const link = `https://qexeron.uz/?symbol=${symbol}`;
            const msg = `ðŸš€ Analyzing #${symbol} on Qexeron!\nCheck here: `;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(msg)}`, '_blank');
        }

        // PWA INSTALL
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'block'; });
        installBtn.addEventListener('click', () => { installBtn.style.display = 'none'; deferredPrompt.prompt(); });
    </script>
